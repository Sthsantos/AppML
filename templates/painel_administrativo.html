<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Ministério de Louvor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-dark text-white">
    <header>
        <div class="navbar">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Ministério de Louvor" class="logo-img">
            </div>
        </div>
    </header>

    <!-- Menu Lateral -->
    <nav class="sidebar">
        <ul>
            <li><a href="{{ url_for('index') }}" class="nav-link"><i class="fas fa-home"></i> Início</a></li>
            <li><a href="{{ url_for('membros') }}" class="nav-link"><i class="fas fa-users"></i> Membros</a></li>
            <li><a href="{{ url_for('feedback') }}" class="nav-link"><i class="fas fa-comments"></i> Suporte e Feedback</a></li>
            <li><a href="{{ url_for('escalas') }}" class="nav-link"><i class="fas fa-calendar"></i> Escalas</a></li>
            <li><a href="#" class="nav-link"><i class="fas fa-bullhorn"></i> Avisos</a></li>
            <li><a href="{{ url_for('cultos') }}" class="nav-link"><i class="fas fa-church"></i> Cultos</a></li>
            <li><a href="{{ url_for('logout') }}" class="nav-link"><i class="fas fa-sign-out-alt"></i> Sair</a></li>
        </ul>
    </nav>

    <main>
        <section class="hero">
            <h1 class="animate-text">Painel Administrativo</h1>
        </section>

        <!-- Gerenciar Membros -->
        <section class="admin-section">
            <h2 class="section-title"><i class="fas fa-users"></i> Gerenciar Membros</h2>
            <div class="admin-form">
                <form id="addMemberForm">
                    <div class="form-group">
                        <label for="memberName" class="form-label">Nome</label>
                        <input type="text" class="form-control bg-dark text-white border-danger" id="memberName" name="name" required placeholder="Nome do membro">
                    </div>
                    <div class="form-group">
                        <label for="memberInstrument" class="form-label">Instrumento</label>
                        <input type="text" class="form-control bg-dark text-white border-danger" id="memberInstrument" name="instrument" placeholder="Ex.: Guitarra">
                    </div>
                    <div class="form-group">
                        <label for="memberEmail" class="form-label">Email</label>
                        <input type="email" class="form-control bg-dark text-white border-danger" id="memberEmail" name="email" required placeholder="seu@email.com">
                    </div>
                    <div class="form-group">
                        <label for="memberPhone" class="form-label">Telefone</label>
                        <input type="text" class="form-control bg-dark text-white border-danger" id="memberPhone" name="phone" placeholder="(99) 9999-9999">
                    </div>
                    <button type="submit" class="btn btn-danger btn-lg">Adicionar Membro</button>
                </form>
                <div id="membrosList" class="mt-4">
                    <h3>Membros Cadastrados</h3>
                    <ul id="membrosUl" class="list-unstyled">
                        {% for member in membros %}
                            <li class="member-item" data-id="{{ member.id }}">
                                <strong>{{ member.name }}</strong> ({{ member.instrument }}) - {{ member.email }} | {{ member.phone }}
                                <button class="btn btn-danger btn-sm float-right edit-member" data-id="{{ member.id }}" data-name="{{ member.name }}" data-instrument="{{ member.instrument }}" data-email="{{ member.email }}" data-phone="{{ member.phone }}">Editar</button>
                                <button class="btn btn-danger btn-sm float-right delete-member" data-id="{{ member.id }}">Excluir</button>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <!-- Modal para editar membro -->
                <div class="modal fade" id="editMemberModal" tabindex="-1" role="dialog" aria-labelledby="editMemberModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content bg-dark border-danger">
                            <div class="modal-header bg-danger text-white">
                                <h5 class="modal-title" id="editMemberModalLabel">Editar Membro</h5>
                                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Fechar">
                                    <span aria-hidden="true">×</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="editMemberForm">
                                    <div class="form-group">
                                        <label for="editMemberName" class="form-label">Nome</label>
                                        <input type="text" class="form-control bg-dark text-white border-danger" id="editMemberName" name="name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editMemberInstrument" class="form-label">Instrumento</label>
                                        <input type="text" class="form-control bg-dark text-white border-danger" id="editMemberInstrument" name="instrument">
                                    </div>
                                    <div class="form-group">
                                        <label for="editMemberEmail" class="form-label">Email</label>
                                        <input type="email" class="form-control bg-dark text-white border-danger" id="editMemberEmail" name="email" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editMemberPhone" class="form-label">Telefone</label>
                                        <input type="text" class="form-control bg-dark text-white border-danger" id="editMemberPhone" name="phone">
                                    </div>
                                    <input type="hidden" id="editMemberId" name="member_id">
                                    <button type="submit" class="btn btn-danger">Salvar</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gerenciar Cultos -->
        <section class="admin-section">
            <h2 class="section-title"><i class="fas fa-church"></i> Gerenciar Cultos</h2>
            <div class="admin-form">
                <form id="addCultoForm">
                    <div class="form-group">
                        <label for="cultoDate" class="form-label">Data (YYYY-MM-DD)</label>
                        <input type="text" class="form-control bg-dark text-white border-danger" id="cultoDate" name="date" required placeholder="2025-03-01">
                    </div>
                    <div class="form-group">
                        <label for="cultoTime" class="form-label">Horário (HH:MM)</label>
                        <input type="text" class="form-control bg-dark text-white border-danger" id="cultoTime" name="time" required placeholder="19:30">
                    </div>
                    <div class="form-group">
                        <label for="cultoDescription" class="form-label">Descrição</label>
                        <input type="text" class="form-control bg-dark text-white border-danger" id="cultoDescription" name="description" required placeholder="Culto de Terça-feira">
                    </div>
                    <button type="submit" class="btn btn-danger btn-lg">Adicionar Culto</button>
                </form>
                <div id="cultosList" class="mt-4">
                    <h3>Cultos Cadastrados</h3>
                    <ul id="cultosUl" class="list-unstyled">
                        {% for culto in cultos %}
                            <li class="culto-item" data-id="{{ culto.id }}">
                                <strong>{{ culto.date }} - {{ culto.time }}</strong> | {{ culto.description }}
                                <button class="btn btn-danger btn-sm float-right edit-culto" data-id="{{ culto.id }}" data-date="{{ culto.date }}" data-time="{{ culto.time }}" data-description="{{ culto.description }}">Editar</button>
                                <button class="btn btn-danger btn-sm float-right delete-culto" data-id="{{ culto.id }}">Excluir</button>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <!-- Modal para editar culto -->
                <div class="modal fade" id="editCultoModal" tabindex="-1" role="dialog" aria-labelledby="editCultoModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content bg-dark border-danger">
                            <div class="modal-header bg-danger text-white">
                                <h5 class="modal-title" id="editCultoModalLabel">Editar Culto</h5>
                                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Fechar">
                                    <span aria-hidden="true">×</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="editCultoForm">
                                    <div class="form-group">
                                        <label for="editCultoDate" class="form-label">Data (YYYY-MM-DD)</label>
                                        <input type="text" class="form-control bg-dark text-white border-danger" id="editCultoDate" name="date" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editCultoTime" class="form-label">Horário (HH:MM)</label>
                                        <input type="text" class="form-control bg-dark text-white border-danger" id="editCultoTime" name="time" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editCultoDescription" class="form-label">Descrição</label>
                                        <input type="text" class="form-control bg-dark text-white border-danger" id="editCultoDescription" name="description" required>
                                    </div>
                                    <input type="hidden" id="editCultoId" name="culto_id">
                                    <button type="submit" class="btn btn-danger">Salvar</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gerenciar Escalas -->
        <section class="admin-section">
            <h2 class="section-title"><i class="fas fa-calendar"></i> Gerenciar Escalas</h2>
            <div class="admin-form">
                <form id="addEscalaForm">
                    <div class="form-group">
                        <label for="memberId" class="form-label">Membro</label>
                        <select class="form-control bg-dark text-white border-danger" id="memberId" name="member_id" required>
                            {% for member in membros %}
                                <option value="{{ member.id }}">{{ member.name }} ({{ member.instrument }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cultoId" class="form-label">Culto</label>
                        <select class="form-control bg-dark text-white border-danger" id="cultoId" name="culto_id" required>
                            {% for culto in cultos %}
                                <option value="{{ culto.id }}">{{ culto.date }} - {{ culto.time }} | {{ culto.description }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="escalaRole" class="form-label">Função</label>
                        <input type="text" class="form-control bg-dark text-white border-danger" id="escalaRole" name="role" required placeholder="Ex.: Guitarrista Principal">
                    </div>
                    <button type="submit" class="btn btn-danger btn-lg">Adicionar Escala</button>
                </form>
                <div id="escalasList" class="mt-4">
                    <h3>Escalas Cadastradas</h3>
                    <ul id="escalasUl" class="list-unstyled">
                        {% for escala in escalas %}
                            <li class="escala-item" data-id="{{ escala.id }}">
                                <strong>{{ escala.member.name }}</strong> - {{ escala.culto.date }} - {{ escala.culto.time }} | {{ escala.culto.description }}<br>
                                Função: {{ escala.role }}
                                <button class="btn btn-danger btn-sm float-right edit-escala" data-id="{{ escala.id }}" data-role="{{ escala.role }}">Editar</button>
                                <button class="btn btn-danger btn-sm float-right delete-escala" data-id="{{ escala.id }}">Excluir</button>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <!-- Modal para editar escala -->
                <div class="modal fade" id="editEscalaModal" tabindex="-1" role="dialog" aria-labelledby="editEscalaModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content bg-dark border-danger">
                            <div class="modal-header bg-danger text-white">
                                <h5 class="modal-title" id="editEscalaModalLabel">Editar Função</h5>
                                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Fechar">
                                    <span aria-hidden="true">×</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="editEscalaForm">
                                    <div class="form-group">
                                        <label for="editRole" class="form-label">Nova Função</label>
                                        <input type="text" class="form-control bg-dark text-white border-danger" id="editRole" name="role" required>
                                    </div>
                                    <input type="hidden" id="editEscalaId" name="escala_id">
                                    <button type="submit" class="btn btn-danger">Salvar</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Barra Inferior -->
    <nav class="bottom-nav">
        <a href="{{ url_for('index') }}" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Início</span>
        </a>
        <a href="{{ url_for('membros') }}" class="nav-item">
            <i class="fas fa-users"></i>
            <span>Membros</span>
        </a>
        <a href="{{ url_for('feedback') }}" class="nav-item">
            <i class="fas fa-comments"></i>
            <span>Suporte e Feedback</span>
        </a>
        <a href="{{ url_for('escalas') }}" class="nav-item">
            <i class="fas fa-calendar"></i>
            <span>Escalas</span>
        </a>
    </nav>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Adicionar membro
            document.getElementById('addMemberForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('memberName').value;
                const instrument = document.getElementById('memberInstrument').value;
                const email = document.getElementById('memberEmail').value;
                const phone = document.getElementById('memberPhone').value;

                fetch('/add_member', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name, instrument: instrument, email: email, phone: phone })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.success) {
                        document.getElementById('addMemberForm').reset();
                        loadMembros(); // Recarrega a lista de membros
                    }
                })
                .catch(error => {
                    console.error('Erro ao adicionar membro:', error);
                    alert('Erro ao adicionar membro. Tente novamente.');
                });
            });

            // Editar membro
            document.querySelectorAll('.edit-member').forEach(button => {
                button.addEventListener('click', function() {
                    const memberId = this.getAttribute('data-id');
                    const name = this.getAttribute('data-name');
                    const instrument = this.getAttribute('data-instrument');
                    const email = this.getAttribute('data-email');
                    const phone = this.getAttribute('data-phone');
                    document.getElementById('editMemberId').value = memberId;
                    document.getElementById('editMemberName').value = name;
                    document.getElementById('editMemberInstrument').value = instrument;
                    document.getElementById('editMemberEmail').value = email;
                    document.getElementById('editMemberPhone').value = phone;
                    $('#editMemberModal').modal('show');
                });
            });

            // Salvar edição de membro
            document.getElementById('editMemberForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const memberId = document.getElementById('editMemberId').value;
                const name = document.getElementById('editMemberName').value;
                const instrument = document.getElementById('editMemberInstrument').value;
                const email = document.getElementById('editMemberEmail').value;
                const phone = document.getElementById('editMemberPhone').value;

                fetch(`/edit_member/${memberId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name, instrument: instrument, email: email, phone: phone })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.success) {
                        $('#editMemberModal').modal('hide');
                        loadMembros(); // Recarrega a lista de membros
                    }
                })
                .catch(error => {
                    console.error('Erro ao editar membro:', error);
                    alert('Erro ao editar membro. Tente novamente.');
                });
            });

            // Excluir membro
            document.querySelectorAll('.delete-member').forEach(button => {
                button.addEventListener('click', function() {
                    const memberId = this.getAttribute('data-id');
                    if (confirm('Tem certeza que deseja excluir este membro?')) {
                        fetch(`/delete_member/${memberId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        })
                        .then(response => response.json())
                        .then(data => {
                            alert(data.message);
                            if (data.success) {
                                loadMembros(); // Recarrega a lista de membros
                            }
                        })
                        .catch(error => {
                            console.error('Erro ao excluir membro:', error);
                            alert('Erro ao excluir membro. Tente novamente.');
                        });
                    }
                });
            });

            // Adicionar culto (mantido do anterior)
            document.getElementById('addCultoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const date = document.getElementById('cultoDate').value;
                const time = document.getElementById('cultoTime').value;
                const description = document.getElementById('cultoDescription').value;

                fetch('/add_culto', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ date: date, time: time, description: description })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.success) {
                        document.getElementById('addCultoForm').reset();
                        loadCultos(); // Recarrega a lista de cultos
                    }
                })
                .catch(error => {
                    console.error('Erro ao adicionar culto:', error);
                    alert('Erro ao adicionar culto. Tente novamente.');
                });
            });

            // Editar culto
            document.querySelectorAll('.edit-culto').forEach(button => {
                button.addEventListener('click', function() {
                    const cultoId = this.getAttribute('data-id');
                    const date = this.getAttribute('data-date');
                    const time = this.getAttribute('data-time');
                    const description = this.getAttribute('data-description');
                    document.getElementById('editCultoId').value = cultoId;
                    document.getElementById('editCultoDate').value = date;
                    document.getElementById('editCultoTime').value = time;
                    document.getElementById('editCultoDescription').value = description;
                    $('#editCultoModal').modal('show');
                });
            });

            // Salvar edição de culto
            document.getElementById('editCultoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const cultoId = document.getElementById('editCultoId').value;
                const date = document.getElementById('editCultoDate').value;
                const time = document.getElementById('editCultoTime').value;
                const description = document.getElementById('editCultoDescription').value;

                fetch(`/edit_culto/${cultoId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ date: date, time: time, description: description })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.success) {
                        $('#editCultoModal').modal('hide');
                        loadCultos(); // Recarrega a lista de cultos
                    }
                })
                .catch(error => {
                    console.error('Erro ao editar culto:', error);
                    alert('Erro ao editar culto. Tente novamente.');
                });
            });

            // Excluir culto
            document.querySelectorAll('.delete-culto').forEach(button => {
                button.addEventListener('click', function() {
                    const cultoId = this.getAttribute('data-id');
                    if (confirm('Tem certeza que deseja excluir este culto?')) {
                        fetch(`/delete_culto/${cultoId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        })
                        .then(response => response.json())
                        .then(data => {
                            alert(data.message);
                            if (data.success) {
                                loadCultos(); // Recarrega a lista de cultos
                            }
                        })
                        .catch(error => {
                            console.error('Erro ao excluir culto:', error);
                            alert('Erro ao excluir culto. Tente novamente.');
                        });
                    }
                });
            });

            // Adicionar escala (mantido do anterior)
            document.getElementById('addEscalaForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const memberId = document.getElementById('memberId').value;
                const cultoId = document.getElementById('cultoId').value;
                const role = document.getElementById('escalaRole').value;

                fetch('/add_escala', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ member_id: memberId, culto_id: cultoId, role: role })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.success) {
                        document.getElementById('addEscalaForm').reset();
                        loadEscalas(); // Recarrega a lista de escalas
                    }
                })
                .catch(error => {
                    console.error('Erro ao adicionar escala:', error);
                    alert('Erro ao adicionar escala. Tente novamente.');
                });
            });

            // Editar escala (mantido do anterior)
            document.querySelectorAll('.edit-escala').forEach(button => {
                button.addEventListener('click', function() {
                    const escalaId = this.getAttribute('data-id');
                    const role = this.getAttribute('data-role');
                    document.getElementById('editEscalaId').value = escalaId;
                    document.getElementById('editRole').value = role;
                    $('#editEscalaModal').modal('show');
                });
            });

            // Salvar edição de escala (mantido do anterior)
            document.getElementById('editEscalaForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const escalaId = document.getElementById('editEscalaId').value;
                const role = document.getElementById('editRole').value;

                fetch(`/edit_escala/${escalaId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ role: role })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.success) {
                        $('#editEscalaModal').modal('hide');
                        loadEscalas(); // Recarrega a lista de escalas
                    }
                })
                .catch(error => {
                    console.error('Erro ao editar escala:', error);
                    alert('Erro ao editar escala. Tente novamente.');
                });
            });

            // Excluir escala (mantido do anterior)
            document.querySelectorAll('.delete-escala').forEach(button => {
                button.addEventListener('click', function() {
                    const escalaId = this.getAttribute('data-id');
                    if (confirm('Tem certeza que deseja excluir esta escala?')) {
                        fetch(`/delete_escala/${escalaId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        })
                        .then(response => response.json())
                        .then(data => {
                            alert(data.message);
                            if (data.success) {
                                loadEscalas(); // Recarrega a lista de escalas
                            }
                        })
                        .catch(error => {
                            console.error('Erro ao excluir escala:', error);
                            alert('Erro ao excluir escala. Tente novamente.');
                        });
                    }
                });
            });

            // Funções para carregar listas dinamicamente
            function loadMembros() {
                fetch('/get_membros')
                    .then(response => response.json())
                    .then(membros => {
                        const membrosUl = document.getElementById('membrosUl');
                        membrosUl.innerHTML = '';
                        membros.forEach(member => {
                            const li = document.createElement('li');
                            li.className = 'member-item';
                            li.setAttribute('data-id', member.id);
                            li.innerHTML = `
                                <strong>${member.name}</strong> (${member.instrument}) - ${member.email} | ${member.phone}
                                <button class="btn btn-danger btn-sm float-right edit-member" data-id="${member.id}" data-name="${member.name}" data-instrument="${member.instrument}" data-email="${member.email}" data-phone="${member.phone}">Editar</button>
                                <button class="btn btn-danger btn-sm float-right delete-member" data-id="${member.id}">Excluir</button>
                            `;
                            membrosUl.appendChild(li);
                        });
                        // Reatachar eventos após recarregar
                        document.querySelectorAll('.edit-member').forEach(button => {
                            button.addEventListener('click', function() {
                                const memberId = this.getAttribute('data-id');
                                const name = this.getAttribute('data-name');
                                const instrument = this.getAttribute('data-instrument');
                                const email = this.getAttribute('data-email');
                                const phone = this.getAttribute('data-phone');
                                document.getElementById('editMemberId').value = memberId;
                                document.getElementById('editMemberName').value = name;
                                document.getElementById('editMemberInstrument').value = instrument;
                                document.getElementById('editMemberEmail').value = email;
                                document.getElementById('editMemberPhone').value = phone;
                                $('#editMemberModal').modal('show');
                            });
                        });
                        document.querySelectorAll('.delete-member').forEach(button => {
                            button.addEventListener('click', function() {
                                const memberId = this.getAttribute('data-id');
                                if (confirm('Tem certeza que deseja excluir este membro?')) {
                                    fetch(`/delete_member/${memberId}`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' }
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        alert(data.message);
                                        if (data.success) {
                                            loadMembros(); // Recarrega a lista de membros
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Erro ao excluir membro:', error);
                                        alert('Erro ao excluir membro. Tente novamente.');
                                    });
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Erro ao carregar membros:', error);
                    });
            }

            function loadCultos() {
                fetch('/get_cult_calendar')
                    .then(response => response.json())
                    .then(cultos => {
                        const cultosUl = document.getElementById('cultosUl');
                        cultosUl.innerHTML = '';
                        cultos.forEach(culto => {
                            const li = document.createElement('li');
                            li.className = 'culto-item';
                            li.setAttribute('data-id', culto.id);
                            li.innerHTML = `
                                <strong>${culto.date} - ${culto.time}</strong> | ${culto.description}
                                <button class="btn btn-danger btn-sm float-right edit-culto" data-id="${culto.id}" data-date="${culto.date}" data-time="${culto.time}" data-description="${culto.description}">Editar</button>
                                <button class="btn btn-danger btn-sm float-right delete-culto" data-id="${culto.id}">Excluir</button>
                            `;
                            cultosUl.appendChild(li);
                        });
                        // Reatachar eventos após recarregar
                        document.querySelectorAll('.edit-culto').forEach(button => {
                            button.addEventListener('click', function() {
                                const cultoId = this.getAttribute('data-id');
                                const date = this.getAttribute('data-date');
                                const time = this.getAttribute('data-time');
                                const description = this.getAttribute('data-description');
                                document.getElementById('editCultoId').value = cultoId;
                                document.getElementById('editCultoDate').value = date;
                                document.getElementById('editCultoTime').value = time;
                                document.getElementById('editCultoDescription').value = description;
                                $('#editCultoModal').modal('show');
                            });
                        });
                        document.querySelectorAll('.delete-culto').forEach(button => {
                            button.addEventListener('click', function() {
                                const cultoId = this.getAttribute('data-id');
                                if (confirm('Tem certeza que deseja excluir este culto?')) {
                                    fetch(`/delete_culto/${cultoId}`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' }
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        alert(data.message);
                                        if (data.success) {
                                            loadCultos(); // Recarrega a lista de cultos
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Erro ao excluir culto:', error);
                                        alert('Erro ao excluir culto. Tente novamente.');
                                    });
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Erro ao carregar cultos:', error);
                    });
            }

            function loadEscalas() {
                fetch('/get_user_scales')  // Ajustar para carregar todas as escalas para o admin
                    .then(response => response.json())
                    .then(escalas => {
                        const escalasUl = document.getElementById('escalasUl');
                        escalasUl.innerHTML = '';
                        escalas.forEach(escala => {
                            const li = document.createElement('li');
                            li.className = 'escala-item';
                            li.setAttribute('data-id', escala.id);
                            li.innerHTML = `
                                <strong>${escala.member.name}</strong> - ${escala.culto.date} - ${escala.culto.time} | ${escala.culto.description}<br>
                                Função: ${escala.role}
                                <button class="btn btn-danger btn-sm float-right edit-escala" data-id="${escala.id}" data-role="${escala.role}">Editar</button>
                                <button class="btn btn-danger btn-sm float-right delete-escala" data-id="${escala.id}">Excluir</button>
                            `;
                            escalasUl.appendChild(li);
                        });
                        // Reatachar eventos após recarregar
                        document.querySelectorAll('.edit-escala').forEach(button => {
                            button.addEventListener('click', function() {
                                const escalaId = this.getAttribute('data-id');
                                const role = this.getAttribute('data-role');
                                document.getElementById('editEscalaId').value = escalaId;
                                document.getElementById('editRole').value = role;
                                $('#editEscalaModal').modal('show');
                            });
                        });
                        document.querySelectorAll('.delete-escala').forEach(button => {
                            button.addEventListener('click', function() {
                                const escalaId = this.getAttribute('data-id');
                                if (confirm('Tem certeza que deseja excluir esta escala?')) {
                                    fetch(`/delete_escala/${escalaId}`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' }
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        alert(data.message);
                                        if (data.success) {
                                            loadEscalas(); // Recarrega a lista de escalas
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Erro ao excluir escala:', error);
                                        alert('Erro ao excluir escala. Tente novamente.');
                                    });
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Erro ao carregar escalas:', error);
                    });
            }

            // Carregar listas inicialmente
            loadMembros();
            loadCultos();
            loadEscalas();
        });

        // Função para abrir/fechar o menu lateral
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('open');
        }
    </script>
</body>
</html>